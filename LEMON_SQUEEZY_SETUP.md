# üçã Lemon Squeezy Setup Guide

## –ó–∞—â–æ Lemon Squeezy?

- ‚úÖ **–î–∏—Ä–µ–∫—Ç–Ω–æ –ø–ª–∞—â–∞–Ω–µ —Å –∫–∞—Ä—Ç–∞** - Visa, Mastercard, Amex, PayPal
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –î–î–°** - –ó–∞ –≤—Å–∏—á–∫–∏ EU –¥—ä—Ä–∂–∞–≤–∏
- ‚úÖ **–ü–æ-–Ω–∏—Å–∫–∏ —Ç–∞–∫—Å–∏** –æ—Ç Stripe
- ‚úÖ **–õ–µ—Å–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –ù—è–∫–æ–ª–∫–æ –º–∏–Ω—É—Ç–∏ setup
- ‚úÖ **–ë–µ–∑–ø–ª–∞—Ç–µ–Ω –ø–ª–∞–Ω** –∑–∞ –Ω–∞—á–∞–ª–æ

---

## –°—Ç—ä–ø–∫–∞ 1: –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ Lemon Squeezy –∞–∫–∞—É–Ω—Ç

1. **–û—Ç–∏–¥–µ—Ç–µ –Ω–∞:** https://lemonsqueezy.com
2. **–ö–ª–∏–∫–Ω–µ—Ç–µ** "Get started" ‚Üí Sign up
3. **–ü–æ–ø—ä–ª–Ω–µ—Ç–µ** –¥–∞–Ω–Ω–∏—Ç–µ —Å–∏
4. **–ü–æ—Ç–≤—ä—Ä–¥–µ—Ç–µ** email –∞–¥—Ä–µ—Å–∞

---

## –°—Ç—ä–ø–∫–∞ 2: –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ Store

1. **–í Dashboard:** –ö–ª–∏–∫–Ω–µ—Ç–µ "Create a store"
2. **–ò–º–µ:** "FactChecker AI" (–∏–ª–∏ –¥—Ä—É–≥–æ)
3. **URL:** factchecker-ai (–∏–ª–∏ –∫–∞–∫–≤–æ—Ç–æ –∏—Å–∫–∞—Ç–µ)
4. **Currency:** EUR (–∑–∞ —Ü–µ–Ω–∏—Ç–µ ‚Ç¨5, ‚Ç¨15, ‚Ç¨44, ‚Ç¨99)
5. **–ó–∞–ø–∞–∑–µ—Ç–µ** store ID-—Ç–æ (—â–µ –≤–∏ —Ç—Ä—è–±–≤–∞)

---

## –°—Ç—ä–ø–∫–∞ 3: –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏

–ó–∞ –≤—Å–µ–∫–∏ tier —Ç—Ä—è–±–≤–∞ –¥–∞ —Å—ä–∑–¥–∞–¥–µ—Ç–µ –ø—Ä–æ–¥—É–∫—Ç + variant:

### **Starter Pack** (‚Ç¨5)
1. **Products** ‚Üí "Create product"
2. **Name:** "Starter Points Pack"
3. **Description:** "500 analysis points"
4. **Price:** ‚Ç¨5.00
5. **Type:** Single payment
6. **–ó–∞–ø–∞–∑–µ—Ç–µ** ‚Üí –ö–æ–ø–∏—Ä–∞–π—Ç–µ **Variant ID**

### **Standard Pack** (‚Ç¨15)
- **Name:** "Standard Points Pack"
- **Price:** ‚Ç¨15.00
- **Description:** "1700 analysis points (1500 + 200 bonus)"
- –ö–æ–ø–∏—Ä–∞–π—Ç–µ **Variant ID**

### **Professional Pack** (‚Ç¨44)
- **Name:** "Professional Points Pack"  
- **Price:** ‚Ç¨44.00
- **Description:** "5500 analysis points (4500 + 1000 bonus)"
- –ö–æ–ø–∏—Ä–∞–π—Ç–µ **Variant ID**

### **Enterprise Pack** (‚Ç¨99)
- **Name:** "Enterprise Points Pack"
- **Price:** ‚Ç¨99.00
- **Description:** "13000 analysis points (10000 + 3000 bonus)"
- –ö–æ–ø–∏—Ä–∞–π—Ç–µ **Variant ID**

---

## –°—Ç—ä–ø–∫–∞ 4: –í–∑–µ–º–∞–Ω–µ –Ω–∞ API –∫–ª—é—á–æ–≤–µ

### API Key:
1. **Settings** ‚Üí **API** 
2. **Create API Key**
3. **Name:** "FactChecker Backend"
4. **Permissions:** Read checkouts, Write checkouts, Read orders
5. **–ö–æ–ø–∏—Ä–∞–π—Ç–µ** –∫–ª—é—á–∞ (–ø–æ–∫–∞–∑–≤–∞ —Å–µ —Å–∞–º–æ –≤–µ–¥–Ω—ä–∂!)

### Store ID:
1. **Settings** ‚Üí **Stores**
2. **–í–∞—à–∏—è—Ç store** ‚Üí –í–∏–∂—Ç–µ ID-—Ç–æ –≤ URL –∏–ª–∏ Settings

### Webhook Secret:
1. **Settings** ‚Üí **Webhooks**
2. **Create webhook**
3. **URL:** `https://your-domain.com/api/lemonsqueezy/webhook`
4. **Events:** –ò–∑–±–µ—Ä–µ—Ç–µ `order_created`
5. **–ö–æ–ø–∏—Ä–∞–π—Ç–µ** Signing Secret

---

## –°—Ç—ä–ø–∫–∞ 5: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω–µ –Ω–∞ .env

–î–æ–±–∞–≤–µ—Ç–µ –≤ `.env` —Ñ–∞–π–ª–∞:

```bash
# Lemon Squeezy Configuration
LEMON_SQUEEZY_API_KEY=your_api_key_here
LEMON_SQUEEZY_STORE_ID=your_store_id_here
LEMON_SQUEEZY_WEBHOOK_SECRET=your_webhook_secret_here
```

---

## –°—Ç—ä–ø–∫–∞ 6: –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ Variant IDs

–û—Ç–≤–æ—Ä–µ—Ç–µ `components/pricing/PricingPage.tsx` –∏ –¥–æ–±–∞–≤–µ—Ç–µ variant IDs:

```typescript
const pricingTiers = [
  {
    id: 'starter',
    variantId: '123456', // ‚¨ÖÔ∏è –í–∞—à–∏—è—Ç Starter variant ID
    // ...
  },
  {
    id: 'standard',
    variantId: '123457', // ‚¨ÖÔ∏è –í–∞—à–∏—è—Ç Standard variant ID
    // ...
  },
  {
    id: 'professional',
    variantId: '123458', // ‚¨ÖÔ∏è –í–∞—à–∏—è—Ç Professional variant ID
    // ...
  },
  {
    id: 'enterprise',
    variantId: '123459', // ‚¨ÖÔ∏è –í–∞—à–∏—è—Ç Enterprise variant ID
    // ...
  }
];
```

---

## –°—Ç—ä–ø–∫–∞ 7: –¢–µ—Å—Ç–≤–∞–Ω–µ

### Test —Ä–µ–∂–∏–º (–±–µ–∑–ø–ª–∞—Ç–Ω–æ):
1. –í Lemon Squeezy dashboard –∞–∫—Ç–∏–≤–∏—Ä–∞–π—Ç–µ **Test mode**
2. –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–∏ –∫–∞—Ä—Ç–∏:
   - **Card:** 4242 4242 4242 4242
   - **Expiry:** –í—Å—è–∫–∞ –±—ä–¥–µ—â–∞ –¥–∞—Ç–∞
   - **CVC:** –í—Å—è–∫–æ 3-—Ü–∏—Ñ—Ä–µ–Ω–æ —á–∏—Å–ª–æ

### –¢–µ—Å—Ç–æ–≤ –ø–æ—Ç–æ–∫:
1. –û—Ç–≤–æ—Ä–µ—Ç–µ `/pricing`
2. –ò–∑–±–µ—Ä–µ—Ç–µ tier
3. –ö–ª–∏–∫–Ω–µ—Ç–µ "–ü–ª–∞—Ç–∏ —Å –∫–∞—Ä—Ç–∞"
4. –©–µ —Å–µ –æ—Ç–≤–æ—Ä–∏ Lemon Squeezy checkout
5. –ü–æ–ø—ä–ª–Ω–µ—Ç–µ —Ç–µ—Å—Ç–æ–≤–∏ –¥–∞–Ω–Ω–∏
6. –ü–æ—Ç–≤—ä—Ä–¥–µ—Ç–µ –ø–ª–∞—â–∞–Ω–µ—Ç–æ
7. –©–µ –±—ä–¥–µ—Ç–µ –ø—Ä–µ–Ω–∞—Å–æ—á–µ–Ω–∏ –æ–±—Ä–∞—Ç–Ω–æ

---

## –°—Ç—ä–ø–∫–∞ 8: Production

### –ö–æ–≥–∞—Ç–æ —Å—Ç–µ –≥–æ—Ç–æ–≤–∏:
1. **–î–µ–∞–∫—Ç–∏–≤–∏—Ä–∞–π—Ç–µ** Test mode
2. **–î–æ–±–∞–≤–µ—Ç–µ** –±–∞–Ω–∫–æ–≤–∏ –¥–µ—Ç–∞–π–ª–∏ –≤ Settings ‚Üí Payouts
3. **–ê–∫—Ç–∏–≤–∏—Ä–∞–π—Ç–µ** Live mode
4. **–¢–µ—Å—Ç–≤–∞–π—Ç–µ** —Å —Ä–µ–∞–ª–Ω–∞ –∫–∞—Ä—Ç–∞ (–º–∞–ª–∫–∞ —Å—É–º–∞)

---

## üîê Webhook Signature Verification (Production)

**–í–ê–ñ–ù–û:** –ó–∞ production —Ç—Ä—è–±–≤–∞ –¥–∞ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–∞—Ç–µ webhook signatures!

–í `server.js` –Ω–∞ —Ä–µ–¥ ~346, –¥–æ–±–∞–≤–µ—Ç–µ:

```javascript
const crypto = require('crypto');

// Verify signature
const hash = crypto
    .createHmac('sha256', webhookSecret)
    .update(req.body.toString())
    .digest('hex');

if (hash !== signature) {
    return res.status(400).json({ error: 'Invalid signature' });
}
```

---

## üí° –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫—Ä–µ–¥–∏—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Ç–æ—á–∫–∏

–°–ª–µ–¥ —É—Å–ø–µ—à–Ω–æ –ø–ª–∞—â–∞–Ω–µ, —Ç—Ä—è–±–≤–∞ –¥–∞ –¥–æ–±–∞–≤–∏—Ç–µ —Ç–æ—á–∫–∏ –∫—ä–º –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è.

–í webhook endpoint (`server.js`):

```javascript
// Import Firebase Admin
import admin from 'firebase-admin';

// In webhook handler:
if (userId && points > 0) {
    const db = admin.firestore();
    await db.collection('users').doc(userId).update({
        pointsBalance: admin.firestore.FieldValue.increment(points)
    });
    
    // Log transaction
    await db.collection('transactions').add({
        userId,
        type: 'purchase',
        amount: points,
        orderId: event.data.id,
        createdAt: new Date()
    });
}
```

---

## üìä Dashboard

–í Lemon Squeezy dashboard –º–æ–∂–µ—Ç–µ –¥–∞ —Å–ª–µ–¥–∏—Ç–µ:
- üí∞ –ü—Ä–æ–¥–∞–∂–±–∏ –≤ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ
- üìà Revenue –≥—Ä–∞—Ñ–∏–∫–∏
- üë• Customer —Å–ø–∏—Å—ä–∫
- üí≥ Refunds —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

---

## ‚ùì Troubleshooting

**"Variant ID is required"**
‚Üí –î–æ–±–∞–≤–µ—Ç–µ variant IDs –≤ `PricingPage.tsx`

**"Lemon Squeezy not configured"**
‚Üí –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ `.env` —Ñ–∞–π–ª–∞ –∑–∞ API key –∏ Store ID

**Checkout –Ω–µ —Å–µ –æ—Ç–≤–∞—Ä—è**
‚Üí –ü—Ä–æ–≤–µ—Ä–µ—Ç–µ console –∑–∞ –≥—Ä–µ—à–∫–∏, —É–≤–µ—Ä–µ—Ç–µ —Å–µ —á–µ –≤–∞—Ä—ñ–∞–Ω—Ç ID –µ –≤–∞–ª–∏–¥–µ–Ω

**Webhook –Ω–µ —Ä–∞–±–æ—Ç–∏**
‚Üí –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ ngrok –∑–∞ –ª–æ–∫–∞–ª–Ω–æ —Ç–µ—Å—Ç–≤–∞–Ω–µ: `ngrok http 8080`

---

**–ì–æ—Ç–æ–≤–æ!** –°–µ–≥–∞ –∏–º–∞—Ç–µ —Ä–∞–±–æ—Ç–µ—â–∞ payment —Å–∏—Å—Ç–µ–º–∞ —Å –¥–∏—Ä–µ–∫—Ç–Ω–æ –ø–ª–∞—â–∞–Ω–µ —Å –∫–∞—Ä—Ç–∞! üéâ
